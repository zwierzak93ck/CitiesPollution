(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{198:function(e,t,n){e.exports=n(322)},321:function(e,t,n){},322:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(12),i=n.n(o),c=n(22),s=n(52),u=n(103),l={informations:null},p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CITIES_INFORMATIONS":return Object(u.a)({},e,{informations:t.informations});default:return e}},d=n(29),f=n(30),m=n(32),h=n(31),b=n(33),v=n(46),O=n.n(v),j=n(48),x=n.n(j),y=n(47),C=n.n(y),g=n(98),w=n.n(g),E=function(e){return r.a.createElement(O.a,{className:"expansion-panel",expanded:e.expanded,onChange:e.handleChange},r.a.createElement(C.a,{expandIcon:r.a.createElement(w.a,null)},r.a.createElement("h2",{className:"title"},e.name," ")),r.a.createElement(x.a,null,r.a.createElement("div",{className:"description"},e.description?e.description:"Data could not be retrieved from the Wikipedia API")))},k=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(m.a)(this,Object(h.a)(t).call(this,e))).handleChange=function(e){return function(t,a){n.setState({expanded:!a||e})}},n.state={expanded:null},n}return Object(b.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e=this;return this.props.informations.name.map(function(t){return r.a.createElement(E,{name:t,description:e.props.informations.description[e.props.informations.name.indexOf(t)],key:Date.now()+Math.random(),handleChange:e.handleChange(t),expanded:e.state.expanded===t})})}}]),t}(a.Component),I=Object(c.b)(function(e){return{informations:e.informations}})(k),S=n(15),N=n.n(S),P=n(37),D=n(38),M=n.n(D),T=n(104),_=n(49),F=n.n(_),V=n(50),q=n.n(V),A=n(67),B=function(e){return r.a.createElement(F.a,{className:"flex-container search-form"},r.a.createElement(q.a,{className:"card-content"},r.a.createElement(T.a,{value:e.setValue,options:e.options,onChange:e.onChange,isClearable:!0})),r.a.createElement(A.b,{className:"card-actions"},r.a.createElement(A.a,{className:"button",onClick:e.onClick,variant:"contained",color:"primary",disabled:e.validate},"Get Data")))},R=function(e){return new Promise(function(t,n){var a=e.transaction("state","readonly").objectStore("state").get(1);a.onsuccess=function(){return t(a.result)},a.onerror=function(){return n(a.error)}})},G=[{value:"FR",label:"France"},{value:"DE",label:"Germany"},{value:"PL",label:"Poland"},{value:"ES",label:"Spain"}],J=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(m.a)(this,Object(h.a)(t).call(this,e))).onValueChange=function(e){n.setState({country:e||null})},n.getMostPollutedCities=Object(P.a)(N.a.mark(function e(){var t,a,r;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=M.a.get("https://api.openaq.org/v1/cities?country="+n.state.country.value+"&order_by=count&limit=10&sort=desc"),e.next=3,M.a.all([t]);case 3:return a=e.sent,r=a[0].data.results.map(function(e){return e.city}),e.abrupt("return",r);case 6:case"end":return e.stop()}},e)})),n.getCitiesDescriptions=function(){var e=Object(P.a)(N.a.mark(function e(t){var n,a,r,o,i;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=[],a=0;case 2:if(!(a<t.length)){e.next=11;break}return r=M.a.get("https://en.wikipedia.org/w/api.php?origin=*&action=query&redirects=1&titles="+t[a]+"&format=json&prop=extracts&exintro&explaintext"),e.next=6,M.a.all([r]);case 6:o=e.sent,n.push(o[0]);case 8:a++,e.next=2;break;case 11:return i=n.map(function(e){var t=e.data.query.pages;return Object.values(t)[0].extract}),e.abrupt("return",i);case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.setCitiesInformations=Object(P.a)(N.a.mark(function e(){var t,a,r;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getMostPollutedCities();case 2:return t=e.sent,e.next=5,n.getCitiesDescriptions(t);case 5:a=e.sent,r={name:t,description:a},n.props.setCitiesInformations(r);case 8:case"end":return e.stop()}},e)})),n.state={country:null},n}return Object(b.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){var e=Object(P.a)(N.a.mark(function e(){var t,n=this;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise(function(e,t){var n=window.indexedDB.open("database - mostPollutedCities",1);n.onupgradeneeded=function(){n.result.createObjectStore("state",{keyPath:"id"})},n.onsuccess=function(){return e(n.result)},n.onerror=function(){return t(n.error)},n.onblocked=function(){alert("Blocked")}});case 2:return t=e.sent,e.next=5,R(t).then(function(e){n.setState({country:e?e.data.country:null})});case 5:window.onbeforeunload=function(){var e,a;e=t,a=n.state,new Promise(function(t,n){var r=e.transaction("state","readwrite").objectStore("state").put({id:1,data:a});r.onsuccess=function(){return t(r.result)},r.onerror=function(){return n(r.error)}})};case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement(B,{options:G,onChange:this.onValueChange,setValue:this.state.country,onClick:this.setCitiesInformations,validate:(e=this.state.country?[this.state.country]:[],e.every(function(e){return e.length>0}))});var e}}]),t}(a.Component),L=Object(c.b)(null,function(e){return{setCitiesInformations:function(t){e({type:"SET_CITIES_INFORMATIONS",informations:t})}}})(J),W=(n(321),function(e){function t(){return Object(d.a)(this,t),Object(m.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(b.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(L,null),this.props.informations?r.a.createElement(I,null):null)}}]),t}(a.Component)),z=Object(c.b)(function(e){return{informations:e.informations}})(W),H=Object(s.b)(p);i.a.render(r.a.createElement(c.a,{store:H},r.a.createElement(z,null)),document.getElementById("root"))}},[[198,1,2]]]);
//# sourceMappingURL=main.d91f37f8.chunk.js.map